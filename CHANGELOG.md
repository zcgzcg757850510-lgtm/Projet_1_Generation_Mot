# 更新日志

## [v1.0.4] - 2025-08-22

### 修复
- **D2生成功能修复**
  - 修复拖拽变换页面D2生成按钮无法生成文件的问题
  - 优化`deformPoint`函数中变形强度默认值处理
  - 修复`exportDeformedSVG`函数中SVG导出逻辑
  - 增强D2生成过程的调试日志和错误处理
  - 确保即使无网格变形也能正常生成D2文件

### 技术改进
- **变形算法优化**：确保变形强度参数正确传递，默认值为1.0
- **SVG导出增强**：修复临时SVG元素处理逻辑，确保变形正确应用
- **调试信息完善**：增加详细的变形过程日志，便于问题诊断
- **后端接口优化**：`/save_d2`接口增加变形状态参数传递

### 影响的文件
- `web/ui.html` - 修复D2生成和SVG导出逻辑
- `web/app.py` - 优化D2保存接口
- 测试文件：`test_d2_api.py`, `test_d2_generation.py`

## [v1.0.3] - 2025-01-XX

### 新增功能
- **D0/D1图像自动加载**：实现D0（原始基线）和D1（处理版本）图像的自动检测和加载显示
- **直接文件搜索API**：新增`/find_d_files`端点，支持按文件类型直接搜索D文件夹
- **网格变形D0支持**：网格变形功能可直接加载和操作D0文件

### 优化改进
- **文件匹配规则优化**：精确识别D0文件（`_orig.svg`后缀）和D1文件（`_d1.svg`后缀）
- **对比功能增强**：D0和D1图像加载后自动显示对比滑块
- **调试日志清理**：移除所有调试输出，保持控制台整洁

### 技术改进
- **强制加载机制**：页面加载时强制执行D0/D1加载，不依赖cookie状态
- **静默错误处理**：所有错误处理改为静默模式，避免控制台噪音
- **API端点优化**：直接扫描文件系统，提供更可靠的文件查找服务

## [v1.0.2] - 2025-08-19

### 功能增强
- **网格变形功能优化**
  - 集成专业的Warp.js库替代手动SVG变形算法
  - 提升变形质量和性能，减少计算负载
  - 自动增加SVG路径密度，提升变形精度
  - 智能坐标转换，自动处理SVG与画布坐标系转换
  - 新SVG加载时自动重置Warp实例，确保状态一致性

### 技术改进
- 移除复杂的手动SVG路径解析和重构代码
- 简化变形算法实现，提高代码可维护性
- 保持原有的局部权重影响和距离衰减算法
- 优化错误处理和调试日志输出

### 影响的文件
- `web/ui.html` - 集成Warp.js库，重构变形算法
- `README.md` - 更新网格变形功能描述
- `docs/WEB_INTERFACE.md` - 更新技术特性说明

### 依赖更新
- 新增外部依赖：Warp.js (通过CDN引入)
- 保持向后兼容，不影响现有功能

## [v1.0.1] - 2025-08-19

### 修复
- **起笔角度与笔画倾斜冲突修复**
  - 修复启用起笔角度功能后笔画倾斜功能失效的问题
  - 修复笔锋角度功能影响倾斜角度随机值的问题
  - 解决系统中三套倾斜机制冲突：旧tilt_stage、模块化变换系统、外部transformer.py
  - 添加缺失的`frac_len`参数，确保起笔角度功能正常执行
  - 为起笔角度、笔锋角度、倾斜角度创建独立的随机数生成器，避免相互干扰

### 技术改进
- 禁用centerline.py中旧的tilt_stage机制，统一使用模块化变换系统
- 优化倾斜变换支持自定义中心点，保护原始笔画几何特征
- 增强参数传递机制，确保Web界面参数正确传递到处理核心

### 影响的文件
- `web/app.py` - 添加frac_len参数传递
- `src/centerline.py` - 禁用旧倾斜机制，独立随机数生成器
- `src/transforms/tilt_transform.py` - 支持自定义中心点

### 测试验证
- ✅ 起笔角度、笔锋角度、笔画倾斜功能可同时启用
- ✅ 各功能互不干扰，角度值保持稳定
- ✅ D0/D1双版本渲染正常工作

## [v1.0.0] - 2025-08-18

### 新增功能
- 初始版本发布
- 支持四种SVG渲染模式（A/B/C/D列）
- 完整的参数配置系统
- Web界面实时预览
- D0基线生成隔离机制
- 模块化变换系统架构
