<!-- Preset Management Modal -->
<div id="presetModal" class="modal hidden">
  <div class="box">
    <div class="toolbar" style="background: var(--glass); backdrop-filter: blur(12px) saturate(120%); -webkit-backdrop-filter: blur(12px) saturate(120%); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; padding: 16px 24px;">
      <div class="left" style="color: var(--fg-0); font-weight: 600;">预设管理</div>
      <div class="right">
        <button type="button" id="btnPresetClose" style="background: var(--glass); border: 1px solid var(--border); color: var(--fg-0); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s;">✖ 关闭</button>
      </div>
    </div>
    <div class="viewport" style="background: var(--bg-1); padding: 24px;">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; width: 100%; max-width: none; margin: 0;">
        
        <!-- Left Panel: Save New Preset -->
        <div class="preset-save-panel" style="background: var(--glass); border: 1px solid var(--border); border-radius: 16px; padding: 20px; backdrop-filter: blur(12px) saturate(120%); -webkit-backdrop-filter: blur(12px) saturate(120%);">
          <div class="form-group" style="margin-bottom: 24px;">
            <label style="display: block; margin-bottom: 8px; color: var(--fg-0); font-weight: 500;">预设名称</label>
            <input type="text" id="newPresetName" placeholder="输入预设名称..." 
                   style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: rgba(255,255,255,.06); color: var(--fg-0); outline: none; transition: border-color 0.2s; font-family: inherit;">
          </div>
          
          <div class="form-group" style="margin-bottom: 24px;">
            <label style="display: block; margin-bottom: 8px; color: var(--fg-0); font-weight: 500;">预设描述</label>
            <textarea id="newPresetDescription" placeholder="输入预设描述（可选）..." rows="4"
                      style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: rgba(255,255,255,.06); color: var(--fg-0); outline: none; transition: border-color 0.2s; font-family: inherit; resize: vertical;"></textarea>
          </div>
          
          <div class="current-params" style="margin-bottom: 24px; padding: 16px; background: rgba(255,255,255,.03); border-radius: 12px; border: 1px solid var(--border);">
            <div style="color: var(--fg-0); font-weight: 500; margin-bottom: 10px;">当前参数预览</div>
            <div id="currentParamsPreview" class="scrollable" style="font-size: 12px; color: var(--muted); line-height: 1.5; max-height: 150px; overflow-y: auto;">
              正在加载参数...
            </div>
          </div>
          
          <div class="action-buttons" style="display: flex; gap: 12px; justify-content: center;">
            <button onclick="saveNewPreset()" 
                    style="padding: 12px 24px; font-size: 14px; background: linear-gradient(135deg, #fff90a, #ffeb3b); 
                           border: none; border-radius: 10px; color: #000; cursor: pointer; font-weight: 600;
                           transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(255, 249, 10, 0.3);">
              💾 保存预设
            </button>
            <button onclick="clearPresetForm()" 
                    style="padding: 12px 20px; font-size: 14px; background: var(--glass); 
                           border: 1px solid var(--border); border-radius: 10px; color: var(--fg-0); cursor: pointer; 
                           transition: all 0.2s ease;">
              刷新表单
            </button>
          </div>
        </div>
        
        <!-- Right Panel: Manage Existing Presets -->
        <div class="preset-manage-panel" style="background: var(--glass); border: 1px solid var(--border); border-radius: 16px; padding: 20px; backdrop-filter: blur(12px) saturate(120%); -webkit-backdrop-filter: blur(12px) saturate(120%);">
          <div style="margin-bottom: 12px;">
            <div style="color: var(--fg-0); font-weight: 600; font-size: 16px;">预设管理</div>
          </div>
          
          <div class="search-box" style="margin-bottom: 16px;">
            <input type="text" id="presetSearchInput" placeholder="搜索预设..." onkeyup="filterPresets()"
                   style="width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border); background: rgba(255,255,255,.06); color: var(--fg-0); outline: none; font-size: 14px;">
          </div>
          
          <div class="preset-controls" style="display: flex; gap: 8px; margin-bottom: 16px; justify-content: center;">
            <button onclick="importPresets()" 
                    style="padding: 8px 16px; font-size: 14px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1)); 
                           color: var(--fg-0); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 8px; cursor: pointer; 
                           transition: all 0.2s ease;">
              📥 导入
            </button>
            <button onclick="exportAllPresets()" 
                    style="padding: 8px 16px; font-size: 14px; background: linear-gradient(135deg, rgba(33, 150, 243, 0.2), rgba(33, 150, 243, 0.1)); 
                           color: var(--fg-0); border: 1px solid rgba(33, 150, 243, 0.3); border-radius: 8px; cursor: pointer; 
                           transition: all 0.2s ease;">
              📤 导出
            </button>
            <button onclick="refreshPresetList()" 
                    style="padding: 8px 16px; font-size: 14px; background: var(--glass); 
                           color: var(--fg-0); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; 
                           transition: all 0.2s ease;">
              🔄 刷新
            </button>
          </div>
          
          <div id="presetList" class="scrollable" style="height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: 12px; background: rgba(255,255,255,.02); 
                                     position: relative; padding: 8px;
                                     box-shadow: inset 0 2px 8px rgba(0,0,0,0.1);
                                     display: grid; grid-template-columns: 1fr; gap: 8px; align-content: start;
                                     /* 当预设数量多时自动变为两列 */">
            <div style="padding: 40px; color: #999; text-align: center; font-size: 14px; grid-column: 1; justify-self: center;">
              <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">⚙️</div>
              <div>预设列表</div>
              <div style="font-size: 12px; margin-top: 8px;">预设将在这里显示</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
